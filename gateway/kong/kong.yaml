_format_version: "3.0"
_transform: true

#---------------------------------------------------
# Services and Routes
#---------------------------------------------------

services:
  - name: auth-service
    url: http://auth-service:4001
    routes:
      - name: auth-service-routes
        paths:
          - "/auth/api/health"
          - "/auth/api/create-organization"
          - "/auth/api/verify-organization-otp"
          - "/auth/api/resend-organization-otp"
          - "/auth/api/login-organization"
          - "/auth/api/login-college"
          - "/auth/api/regenerate-access-token-organization"
          - "/auth/api/regenerate-access-token-college"
          - "/auth/api/forgot-password-organization"
          - "/auth/api/forgot-password-college"
          - "/auth/api/forgot-reset-password-college"
          - "/auth/api/reset-password-college"
          - "/auth/api/login-non-teaching-staff"  
          - "/auth/api/forgot-password-non-teaching-staff"
          - "/auth/api/reset-forgot-password-non-teaching-staff"
          - "/auth/api/regenerate-access-token-non-teaching-staff"
          - "/auth/api/login-hod"
          - "/auth/api/forgot-password-hod"
          - "/auth/api/forgot-reset-password-hod"
          - "/auth/api/login-student"
          - "/auth/api/regenerate-access-token-student"
          - "/auth/api/forgot-password-student"
          - "/auth/api/forgot-reset-password-student"
        strip_path: false

      - name: auth-service-swagger
        paths:
          - "~/auth/api/api-docs.*"
        strip_path: false
        preserve_host: true
        methods:
          - GET
        regex_priority: 10

      - name: auth-service-routes-protected
        paths:
          - "/auth/api/test-protected"
          - "/auth/api/create-college"
          - "/auth/api/logout-organization"
          - "/auth/api/logout-college"
          - "/auth/api/create-non-teaching-staff-bulk"
          - "/auth/api/reset-password-non-teaching-staff"
          - "/auth/api/reset-password-college"
          - "/auth/api/reset-password-organization"
          - "/auth/api/add-department" #later this will shift another service which is department service
          - "/auth/api/add-course"
          - "/auth/api/add-batch"
          - "/auth/api/add-section"
          - "/auth/api/create-student-bulk"
          - "/auth/api/create-hod"
          - "/auth/api/logout-hod"
          - "/auth/api/regenerate-access-token-hod"
          - "/auth/api/reset-password-hod"
          - "/auth/api/logout-student"
          - "/auth/api/reset-password-student"
        strip_path: false
        plugins:
          - name: paseto-vault-auth-lua
            config:
              vault_address: "http://vault:8200"
              vault_token: "dev-root-token"
              header_prefix: "X-User-"
              cache_timeout: 3600
              required_roles: []
              redis_host: "redis"
              redis_port: 6379
              redis_password: "redis_pass"
              redis_database: 0
              redis_timeout: 2000
              validate_session: true

