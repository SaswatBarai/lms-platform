# gateway/kong/kong.yaml - Simplified version
_format_version: "3.0"
_transform: true

# Upstream services configuration
services:
  # Auth Service - handles authentication endpoints
  - name: auth-service
    url: http://auth-service:4001
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 3
    tags: ["auth", "microservice"]
    routes:
      # Public login endpoint (no authentication required)
      - name: auth-login
        paths: ["/api/auth/login"]
        methods: ["POST"]
        strip_path: true
        tags: ["auth", "public"]

      # Public refresh token endpoint
      - name: auth-refresh  
        paths: ["/api/auth/refresh"]
        methods: ["POST"]
        strip_path: true
        tags: ["auth", "public"]

      # Public registration endpoint (if enabled)
      - name: auth-register
        paths: ["/api/auth/register"]
        methods: ["POST"]
        strip_path: true
        tags: ["auth", "public"]

      # Protected logout endpoint
      - name: auth-logout
        paths: ["/api/auth/logout"]
        methods: ["POST"]
        strip_path: true
        tags: ["auth", "protected"]

      # User profile endpoints
      - name: auth-profile
        paths: ["/api/auth/profile"]
        methods: ["GET", "PUT", "PATCH"]
        strip_path: true
        tags: ["auth", "protected"]

  # Notification Service - handles notifications and messaging
  - name: notification-service
    url: http://notification-service:4002
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 3
    tags: ["notification", "microservice"]
    routes:
      # User notifications
      - name: user-notifications
        paths: ["/api/notifications"]
        methods: ["GET", "POST", "PUT", "DELETE"]
        strip_path: false
        tags: ["notification", "protected"]

  # Infrastructure Service - handles system management
  - name: infrastructure-service  
    url: http://infrastructure-service:4003
    connect_timeout: 60000
    write_timeout: 60000
    read_timeout: 60000
    retries: 3
    tags: ["infrastructure", "microservice"]
    routes:
      # System health and metrics (admin only)
      - name: infrastructure-health
        paths: ["/api/infrastructure/health"]
        methods: ["GET"]
        strip_path: false
        tags: ["infrastructure", "health"]